openapi: "3.1.0"
info:
  title: "T56 API"
  description: "T56 API"
  version: "1.0.0"
servers:
  - url: "http://localhost:8085"
    description: "Server for local development without dockerization"
  - url: "http://t5-controller:8085"
    description: "Server address inside the docker network"
paths:
  /StartGame:
    post:
      summary: "Start a new game"
      description: "Verify that a game with the same game mode doesn't exist already,\
        \ them creates and starts a new game\nfor the given player and configuration\
        \ parameters."
      operationId: ""
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/StartGameRequestDTO"
        required: true
      responses:
        "200":
          description: "OK"
          content:
            '*/*':
              schema:
                $ref: "#/components/schemas/StartGameResponseDTO"
  /run:
    post:
      summary: "Start, execute and close a turn"
      description: "Main entry point of the game engine.\nThis endpoint executes a\
        \ single turn within an ongoing game.\nThe playerâ€™s test code is compiled\
        \ and evaluated, the session state is updated, and achievements are checked\
        \ and unlocked if applicable.\nThe endpoint returns the evaluation results\
        \ to the player.\n"
      operationId: ""
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/RunGameRequestDTO"
        required: true
      responses:
        "200":
          description: "OK"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/RunGameResponseDTO"
  /leave:
    post:
      summary: "Leave or pause the current game session"
      description: "Handles the user's decision to leave an ongoing game (e.g., closing\
        \ the browser or tab).\nThe endpoint saves the currently available common\
        \ and specific game data.\n\nCommon data for all game modes:\n- `testingClassCode`:\
        \ the test code available in that moment in the player editor\n\nSpecific\
        \ data for single-player games:\n- `remainingTime`: the time left before the\
        \ match ends.\n"
      operationId: ""
      requestBody:
        content:
          text/plain:
            schema:
              type: "string"
        required: true
      responses:
        "200":
          description: "OK"
          content:
            '*/*':
              schema:
                $ref: "#/components/schemas/RunGameResponseDTO"
  /EndGame:
    post:
      summary: "End the game"
      description: "Handles the termination of an ongoing game.\nThe endpoint finalizes\
        \ the game, evaluates the player's last turn, updates the session state,\n\
        checks for unlocked achievements, and returns the final results.\n"
      operationId: ""
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/RunGameRequestDTO"
        required: true
      responses:
        "200":
          description: "OK"
          content:
            '*/*':
              schema:
                $ref: "#/components/schemas/EndGameResponseDTO"
  /SurrenderGame/{playerId}:
    delete:
      summary: "Surrender an ongoing game"
      description: "Allows the player to surrender the current game session.\nThe\
        \ game is finalized as surrendered and closed accordingly.\n"
      operationId: ""
      parameters:
        - name: "playerId"
          in: "path"
          required: true
          description: "ID of the player surrendering the game"
          schema:
            type: "integer"
            format: "int64"
        - name: "mode"
          in: "query"
          required: true
          description: "Game mode of the ongoing game"
          schema:
            type: "string"
            enum:
              - "PartitaSingola"
              - "Allenamento"
              - "Scalata"
      responses:
        "200":
          description: "OK"
          content:
            '*/*':
              schema:
                $ref: "#/components/schemas/EndGameResponseDTO"
components:
  schemas:
    StartGameRequestDTO:
      type: "object"
      properties:
        playerId:
          type: "integer"
          format: "int64"
        typeRobot:
          type: "string"
        difficulty:
          type: "string"
          enum:
            - "EASY"
            - "MEDIUM"
            - "HARD"
        mode:
          type: "string"
          enum:
            - "PartitaSingola"
            - "Allenamento"
            - "Scalata"
        underTestClassName:
          type: "string"
    StartGameResponseDTO:
      type: "object"
      properties:
        gameId:
          type: "integer"
          format: "int64"
        status:
          type: "string"
    RunGameRequestDTO:
      type: "object"
      properties:
        classUTCode:
          type: "string"
        testingClassCode:
          type: "string"
        playerId:
          type: "integer"
          format: "int64"
        mode:
          type: "string"
          enum:
            - "PartitaSingola"
            - "Allenamento"
            - "Scalata"
    CoverageResult:
      type: "object"
      properties:
        covered:
          type: "integer"
          format: "int32"
        missed:
          type: "integer"
          format: "int32"
        percentage:
          type: "number"
          format: "double"
        errorMessage:
          type: "string"
    CompileResult:
      type: "object"
      properties:
        compileOutput:
          type: "string"
        xml_coverage:
          type: "string"
        jacoco_line:
          $ref: "#/components/schemas/CoverageResult"
        jacoco_branch:
          $ref: "#/components/schemas/CoverageResult"
        jacoco_instruction:
          $ref: "#/components/schemas/CoverageResult"
        evosuite_line:
          $ref: "#/components/schemas/CoverageResult"
        evosuite_branch:
          $ref: "#/components/schemas/CoverageResult"
        evosuite_exception:
          $ref: "#/components/schemas/CoverageResult"
        evosuite_weak_mutation:
          $ref: "#/components/schemas/CoverageResult"
        evosuite_output:
          $ref: "#/components/schemas/CoverageResult"
        evosuite_method:
          $ref: "#/components/schemas/CoverageResult"
        evosuite_method_no_exception:
          $ref: "#/components/schemas/CoverageResult"
        evosuite_cbranch:
          $ref: "#/components/schemas/CoverageResult"
    RunGameResponseDTO:
      type: "object"
      properties:
        canWin:
          type: "boolean"
        userScore:
          type: "integer"
          format: "int32"
        robotScore:
          type: "integer"
          format: "int32"
        userCoverageDetails:
          $ref: "#/components/schemas/CompileResult"
        robotCoverageDetails:
          $ref: "#/components/schemas/CompileResult"
        unlockedAchievements:
          type: "array"
          items:
            type: "string"
    EndGameResponseDTO:
      type: "object"
      properties:
        achievementsUnlocked:
          type: "array"
          items:
            type: "string"
        runGameResponse:
          $ref: "#/components/schemas/RunGameResponseDTO"
        robotScore:
          type: "integer"
          format: "int32"
        userScore:
          type: "integer"
          format: "int32"
        isWinner:
          type: "boolean"
        expGained:
          type: "integer"
          format: "int32"