<!DOCTYPE html>
<html lang="it" data-bs-theme="dark">
<head>
    <div th:replace="fragments/header :: header"></div>
    <title th:text="${user != null ? user.userProfile.name + ' ' + user.userProfile.surname : 'Profilo non trovato'}">Profilo Amico</title>
    <style>
        .profile-header-avatar { width: 160px; height: 160px; object-fit: cover; border: 6px solid #212529; box-shadow: 0 0 20px rgba(0,0,0,0.5); background-color: #212529; }
        .profile-card { background: linear-gradient(145deg, #1a1d20, #212529); border: none; border-radius: 15px; margin-top: 80px; padding-top: 90px; position: relative; overflow: visible; }
        .stat-box { background-color: #2c3034; border-radius: 12px; transition: transform 0.2s; border-left: 5px solid #0d6efd; }
        .stat-box:hover { transform: translateY(-5px); background-color: #343a40; }
        .progress_container { position: relative; width: 150px; height: 150px; margin: 0 auto; }
        .progress-svg { transform: rotate(-90deg); }
        .progress_background { fill: none; stroke: #333; stroke-width: 12; }
        .progress_fill { fill: none; stroke: #d10b4f; stroke-width: 12; stroke-linecap: round; stroke-dasharray: 314; stroke-dashoffset: 314; transition: stroke-dashoffset 1.5s ease-in-out; }
        .progress_value { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); font-size: 24px; font-weight: bold; color: white; }
    </style>
</head>

<body class="bg-dark text-light">
<div th:replace="fragments/navbar :: navbar"></div>

<div class="container pb-5">
    
    <div class="row mb-3 mt-4">
        <div class="col-12">
            <a href="/SearchFriend" class="btn btn-outline-secondary btn-sm"><i class="fas fa-arrow-left me-2"></i>Torna alla Ricerca</a>
        </div>
    </div>

    <div class="row justify-content-center" th:if="${user == null}">
        <div class="col-lg-8 text-center">
            <div class="alert alert-warning">
                <h4><i class="fas fa-exclamation-triangle"></i> Utente non trovato</h4>
                <p>Impossibile visualizzare il profilo richiesto.</p>
                <a href="/SearchFriend" class="btn btn-primary mt-2">Cerca qualcun altro</a>
            </div>
        </div>
    </div>

    <div class="row justify-content-center" th:if="${user != null}">
        <div class="col-lg-8">
            <div class="card profile-card shadow text-center position-relative">
                <div class="position-absolute top-0 start-50 translate-middle">
                    <img th:src="${user.userProfile.profilePicturePath != null ? '/t5/images/profileImages/' + user.userProfile.profilePicturePath : '/t5/images/default.png'}"
                         class="rounded-circle profile-header-avatar" alt="Avatar"
                         onerror="this.src='/t5/images/profileImages/default.png'">
                </div>

                <div class="card-body px-5 pb-4">
                    <h2 class="fw-bold mb-0" th:text="${user.userProfile.name} + ' ' + ${user.userProfile.surname}">Nome</h2>
                    <p class="text-primary mb-3 fw-semibold" th:text="'@' + ${user.userProfile.nickname}">@nickname</p>

                    <div class="bg-dark bg-opacity-50 p-3 rounded mb-4 d-inline-flex align-items-start justify-content-center" style="max-width: 600px;">
                        <i class="fas fa-quote-left text-secondary me-2" style="font-size: 0.9rem; transform: translateY(-3px);"></i>
                        <span class="fst-italic text-light" style="line-height: 1.4;" th:text="${user.userProfile.bio ?: 'Nessuna biografia.'}"></span>
                        <i class="fas fa-quote-right text-secondary ms-2" style="font-size: 0.9rem; transform: translateY(-3px);"></i>
                    </div>

                    <div class="mt-3">
                        <button id="followButton" 
                                class="btn px-5 fw-bold rounded-pill shadow-sm"
                                th:classappend="${amIFollowing} ? 'btn-danger' : 'btn-primary'"
                                th:text="${amIFollowing} ? 'Unfollow' : 'Follow'"
                                th:attr="data-friend-id=${user.id}">
                            Follow
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="row justify-content-center mt-5" th:if="${user != null}">
        <div class="col-lg-10">
            <div class="bg-dark rounded-4 p-4 shadow border border-secondary border-opacity-25">
                <h4 class="border-bottom border-secondary pb-2 mb-4 text-center">Statistiche Giocatore</h4>
                
                <div th:if="${playerProgress != null}" class="row g-4 text-center">
                    <div class="col-md-4">
                        <div class="stat-box p-4 h-100">
                            <h1 class="display-4 fw-bold text-primary mb-0" th:text="${playerProgress.experiencePoints}">0</h1>
                            <p class="text-uppercase text-muted small fw-bold spacing-2">XP Totali</p>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="stat-box p-4 h-100" style="border-left-color: #198754;">
                            <h1 class="display-4 fw-bold text-success mb-0" th:text="${playerProgress.gameProgressesDTO != null ? playerProgress.gameProgressesDTO.size() : 0}">0</h1>
                            <p class="text-uppercase text-muted small fw-bold spacing-2">Partite</p>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="stat-box p-4 h-100 border-warning" style="border-left-color: #ffc107;">
                            <h1 class="display-4 fw-bold text-warning mb-0" th:text="${playerProgress.gameProgressesDTO != null ? playerProgress.gameProgressesDTO.?[isWon == true].size() : 0}">0</h1>
                            <p class="text-uppercase text-muted small fw-bold spacing-2">Vittorie</p>
                        </div>
                    </div>
                </div>
                
                <div th:if="${playerProgress == null}" class="text-center text-muted py-3">
                    <i class="fas fa-chart-bar me-2 opacity-50"></i>Statistiche non ancora disponibili.
                </div>
            </div>
        </div>
    </div>
</div>

<div th:replace="fragments/footer :: footer"></div>

<span id="userProfileID" class="d-none" th:text="${userInfo != null ? userInfo.userProfile.id : ''}"></span>

<script src="/t5/js/friend_profile.js"></script>

</body>
</html>